# 🚀 Task 2 & 3 快速测试指南

## 一、后端测试

### 1. 启动后端
```bash
cd backend
.\.venv\Scripts\python.exe -m uvicorn main:app --reload --port 8000
```

**期望输出**:
```
2026-01-29 XX:XX:XX | INFO | 🚀 [AIService] Initializing Dating Advisor Service...
2026-01-29 XX:XX:XX | SUCCESS | ✅ [Config] Model: Qwen/Qwen2.5-72B-Instruct | Temp: 0.95
```

### 2. 测试日志接口
```bash
curl http://127.0.0.1:8000/api/system/logs?lines=10
```

**期望返回**: 最近 10 行日志，包含时间戳和日志信息

### 3. 测试记忆功能（使用测试脚本）
```bash
cd backend
python test_memory.py
```

**测试内容**:
- ✅ 第一轮对话（无历史）
- ✅ 第二轮对话（带前面的历史）
- ✅ 日志接口响应
- ✅ 历史长度限制验证

**期望结果**: 所有测试通过，第二轮对话的 AI 回复应该参考第一轮的内容

---

## 二、前端测试

### 1. 启动前端
```bash
cd client
pnpm dev
```

**期望**: Electron 窗口打开，显示恋爱军师界面

### 2. 测试记忆功能

**步骤**:
1. 输入第一句: `"我喜欢你"`
2. 等待 AI 生成 3 个建议
3. 记住其中一个建议（如第一个）
4. 输入第二句: `"你为什么不回应我？"`
5. 观察 AI 的分析和建议

**期望结果**: 第二轮的建议应该提到或参考第一轮的内容

### 3. 测试设置面板

**步骤**:
1. 点击界面上的"设置"图标（或侧边栏设置）
2. 点击"⚙️ 打开完整设置面板"按钮
3. 应该看到现代化的设置面板弹出

**验证功能**:

#### a) 记忆深度设置
- ✅ 拖动滑块从 8 调整到 32
- ✅ 数字实时显示变化
- ✅ 颜色渐变效果（青色部分随滑块移动）
- ✅ 下方显示建议文本（轻量/标准/完整）

#### b) 日志查看器
- ✅ 点击"显示"按钮
- ✅ 应该出现黑底绿字的终端风格日志区域
- ✅ 日志内容包含时间戳和 emoji 标记
- ✅ 点击"刷新"按钮可获取最新日志
- ✅ 点击"隐藏"按钮日志区域消失

#### c) 清除会话
- ✅ 点击"清除全部"按钮
- ✅ 弹出确认对话框
- ✅ 确认后所有对话记录清空

### 4. 测试记忆深度实际效果

**步骤**:
1. 打开设置面板，将记忆深度设置为 `8`
2. 进行 5 轮对话（共 10 条消息：5 用户 + 5 AI）
3. 第 6 轮对话时，输入引用第 1 轮内容的话
4. 观察 AI 是否能记住（应该能，因为在 8 条范围内）
5. 将记忆深度改为 `2`
6. 进行 3 轮新对话后，再次引用第 1 轮内容
7. 观察 AI 是否记住（应该不记得，因为超出 2 条范围）

---

## 三、集成测试

### 场景 1: 多轮恋爱咨询

```
用户: "我暗恋一个女生，但不知道怎么表白"
AI: [生成3个建议，如: 高冷风格/元气风格/中二风格]

用户: "我害怕被拒绝怎么办？"
AI: [应该理解前面提到"表白"，给出针对性建议]

用户: "如果她说需要考虑一下，我该怎么回应？"
AI: [应该知道上下文是关于表白和担心被拒，给出恰当建议]
```

**验证点**:
- ✅ AI 的分析提到"前面提到的表白"
- ✅ 建议连贯，不重复基础内容
- ✅ 日志显示 `History Depth: X messages`

### 场景 2: 记忆深度对比

**测试 A (记忆深度 8)**:
```bash
# 在设置中设置为 8
# 进行 5 轮对话
# 第 6 轮引用第 1 轮内容 → 应该记得
```

**测试 B (记忆深度 2)**:
```bash
# 在设置中设置为 2
# 进行 3 轮对话
# 第 4 轮引用第 1 轮内容 → 不应该记得
```

### 场景 3: 日志监控

**步骤**:
1. 打开设置面板，启用日志查看
2. 在主界面输入对话
3. 点击日志"刷新"按钮
4. 查找类似这样的日志:
```
🎲 [Random] Styles: ['高冷', '元气', '中二'] | History Depth: 4
⚡ [Request] Input: 你为什么不回应我？... | Context: 4 messages
✅ [LLM] Generation successful | Options: 3
```

**验证**:
- ✅ `History Depth` 数字与设置的记忆深度一致
- ✅ `Context: X messages` 显示实际传递的历史条数

---

## 四、常见问题排查

### 问题 1: 日志接口返回 "Log file not found"

**原因**: 后端尚未写入日志文件

**解决**:
1. 确保后端已启动
2. 进行至少一次对话生成
3. 刷新日志查看器

### 问题 2: AI 似乎没有记住前面的内容

**排查步骤**:
1. 检查设置面板中的记忆深度
2. 计算实际对话轮数（用户+AI 算 2 条）
3. 查看日志确认 `History Depth`
4. 如果日志显示 `History Depth: 0`，检查前端 store 是否正确截取历史

### 问题 3: 设置面板打不开

**排查**:
1. 检查浏览器控制台是否有错误
2. 确认 `SettingsModal.js` 已正确导入
3. 确认 Framer Motion 依赖已安装: `pnpm install framer-motion`

### 问题 4: 记忆深度滑块不工作

**排查**:
1. 打开 Redux DevTools 或 Zustand DevTools
2. 检查 `memoryMax` 状态是否更新
3. 检查 `setMemoryMax` 是否正确调用
4. 查看 console.log 中的 `[Store] Sending request with history` 输出

---

## 五、成功标准

### Task 2 后端 ✅

- [ ] 日志文件正常生成在 `backend/logs/`
- [ ] `/api/system/logs` 接口返回日志内容
- [ ] `/api/chat` 接口接收 `history` 参数
- [ ] `/api/generate` 接口接收 `history` 参数
- [ ] AI 生成的分析提到前文内容
- [ ] test_memory.py 所有测试通过

### Task 3 前端 ✅

- [ ] 设置面板成功打开
- [ ] 记忆深度滑块可调节 (8-32)
- [ ] 日志查看器显示后端日志
- [ ] 刷新按钮更新日志内容
- [ ] 清除会话功能工作正常
- [ ] 多轮对话中 AI 参考历史内容
- [ ] store 中 `memoryMax` 状态持久化

---

## 六、性能指标

**理想响应时间**:

| 记忆深度 | 首次生成 | 后续生成 |
|---------|---------|---------|
| 8 条    | 1-2s    | 1-2s    |
| 16 条   | 2-3s    | 2-3s    |
| 32 条   | 3-5s    | 3-5s    |

**日志加载时间**:
- 100 行日志: < 500ms
- 500 行日志: < 1s

---

## 七、下一步建议

完成以上测试后，可以：

1. **调整记忆策略**: 根据实际使用体验优化默认记忆深度
2. **性能优化**: 如果发现慢，考虑历史摘要化
3. **UI 优化**: 添加记忆深度生效提示、历史可视化
4. **功能扩展**: 流式输出、导出对话、主题切换

---

**测试完成时间**: ____年____月____日  
**测试人员**: _____________  
**测试结果**: ⬜ 全部通过 ⬜ 部分通过 ⬜ 未通过  
**备注**: ________________________________
