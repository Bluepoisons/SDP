# v3.0 æ²‰æµ¸å¼æƒ…æ„Ÿäº¤äº’ç³»ç»Ÿ - å®æ–½æ–‡æ¡£

## ğŸ“¦ å·²å®Œæˆçš„ä¿®æ”¹

### 1. åç«¯é‡æ„ (Backend)

#### ğŸ“„ `backend/models/schemas.py`
- âœ… åœ¨ `ReplyOption` ä¸­æ–°å¢ `kaomoji: str` å­—æ®µ
- âœ… ä¿®æ”¹ `text` å­—æ®µæè¿°ä¸º"çº¯å‡€çš„å›å¤æ–‡æœ¬ï¼ˆä¸å«é¢œæ–‡å­—ï¼‰"
- âœ… æ›´æ–° `score` å­—æ®µæè¿°ï¼š"å¥½æ„Ÿåº¦/æƒ…å•†è¯„åˆ† (-3=ç¾éš¾ ~ +3=å¿ƒåŠ¨)"
- âœ… ä¿ç•™ `style` / `style_name` å­—æ®µç”¨äºåç«¯è°ƒè¯•ï¼ˆå‰ç«¯ä¸å†æ˜¾ç¤ºï¼‰

**å˜æ›´å†…å®¹**ï¼š
```python
class ReplyOption(BaseModel):
    style: str          # åç«¯ä¿ç•™ç”¨äºè°ƒè¯•
    style_name: str     # å‰ç«¯ä¸å†æ˜¾ç¤º
    text: str           # çº¯å‡€æ–‡æœ¬ï¼ˆä¸å«é¢œæ–‡å­—ï¼‰
    kaomoji: str        # ç‹¬ç«‹æå–çš„é¢œæ–‡å­—
    score: int          # -3 ~ +3
```

#### ğŸ“„ `backend/config/styles.py`
- âœ… ä¿®æ”¹ Prompt æ¨¡æ¿ï¼Œæ˜ç¡®è¦æ±‚åˆ†ç¦»é¢œæ–‡å­—å’Œæ­£æ–‡
- âœ… æ›´æ–° JSON è¾“å‡ºæ ¼å¼ç¤ºä¾‹ï¼Œå±•ç¤º `text` + `kaomoji` ç»“æ„
- âœ… ç»†åŒ– `score` è¯„åˆ†æ ‡å‡†è¯´æ˜ï¼ˆ+3/+2/+1/0/-1/-2/-3ï¼‰

**Prompt æ ¸å¿ƒå˜æ›´**ï¼š
```
# Requirements for Each Option
- **text**: The pure reply text WITHOUT Kaomoji
- **kaomoji**: A single, expressive Kaomoji (e.g. "(Ë˜Â³Ë˜)â™¥")
- **score**: -3 to 3 favorability impact
```

---

### 2. å‰ç«¯ UI é‡æ„ (Frontend)

#### ğŸ†• `client/src/components/OptionCard.vue`
**å…¨æ–°ç»„ä»¶** - åŸºäº Vue 3 + TypeScript + Tailwind CSS v4

**æ ¸å¿ƒç‰¹æ€§**ï¼š
1. **é¢œè‰²ç³»ç»Ÿ** - åŸºäº `score` çš„è‡ªåŠ¨æ˜ å°„
   - `score >= 2`: ç²‰è‰²ç³» (ğŸ’– å¿ƒåŠ¨/é«˜æƒ…å•†)
   - `score <= -2`: ç´«è‰²ç³» (ğŸ’” ç¾éš¾/æ‰ä»·)
   - `-1 ~ +1`: é’è‰²ç³» (ğŸ”µ å®‰å…¨/æ ‡å‡†)

2. **è§†è§‰å…ƒç´ **
   - å¥½æ„Ÿåº¦å¾½ç« ï¼šå·¦ä¸Šè§’ `â¤ +2` / `ğŸ’” -3`
   - çº¯å‡€æ­£æ–‡ï¼šä¸­å¤®åŒºåŸŸï¼Œæ— æ‚è´¨
   - é¢œæ–‡å­—è£…é¥°ï¼šå³ä¸‹è§’å°å­—ï¼Œhover æ˜¾çœ¼
   - èƒŒæ™¯æ°´å°ï¼šå·¨å¤§åŠé€æ˜é¢œæ–‡å­—ï¼Œå¢å¼ºæ°›å›´

3. **äº¤äº’åé¦ˆ**
   - Hover: è¾¹æ¡†å‘å…‰ + ç¼©æ”¾ `1.01`
   - Selected: ç¼©æ”¾ `1.02` + ç™½è‰²å…‰æ™•
   - æç«¯åˆ†æ•°æ ‡è¯†ï¼š+3 æ˜¾ç¤º"âœ¨ å®Œç¾"ï¼Œ-3 æ˜¾ç¤º"âš ï¸ å±é™©"

**Props æ¥å£**ï¼š
```typescript
{
  option: {
    text: string;      // çº¯å‡€æ–‡æœ¬
    kaomoji?: string;  // é¢œæ–‡å­—ï¼ˆå¯é€‰ï¼‰
    score: number;     // -3 ~ +3
  };
  selected?: boolean;
}
```

---

#### ğŸ”„ å·²æ›´æ–°çš„ç»„ä»¶

##### `client/src/components/MessageBubble.vue`
- âœ… å¯¼å…¥ `OptionCard.vue`
- âœ… æ›¿æ¢æ—§çš„å†…è”å¡ç‰‡ä¸º `<OptionCard>`
- âœ… ç§»é™¤åŸæœ‰çš„ `style` / `effect` æ˜¾ç¤ºé€»è¾‘

**å˜æ›´ç‚¹**ï¼š
```vue
<!-- æ—§ç‰ˆ -->
<Card @click="handleSelect(option)">
  <p>{{ option.text }}</p>
  <span>{{ option.style }}</span>
</Card>

<!-- æ–°ç‰ˆ v3.0 -->
<OptionCard 
  :option="option" 
  @select="handleSelect" 
/>
```

---

##### `client/src/components/ChoiceMatrix.vue`
- âœ… å¯¼å…¥ `OptionCard.vue`
- âœ… æ›¿æ¢å…¨å±é€‰æ‹©æ¨¡å¼çš„å¡ç‰‡
- âœ… ç§»é™¤æ—§çš„ `styleClass()` å‡½æ•°

**å˜æ›´ç‚¹**ï¼š
```vue
<!-- æ–°ç‰ˆæ”¯æŒ selected çŠ¶æ€ -->
<OptionCard 
  v-for="option in options"
  :option="option"
  :selected="activeOptionId === option.id"
  @select="handleSelect"
/>
```

---

##### `client/src/components/panels/DashboardPanel.vue`
- âœ… å¯¼å…¥ `OptionCard.vue`
- âœ… æ›¿æ¢ Dashboard å¿«é€Ÿæµ‹è¯•é¢æ¿çš„é€‰é¡¹å±•ç¤º
- âœ… ç®€åŒ–é€‰æ‹©é€»è¾‘ï¼ˆä¸å†éœ€è¦å¤„ç†æ—§çš„ `style`/`emoji` å­—æ®µï¼‰

---

## ğŸ¨ é¢œè‰²ç³»ç»Ÿæ˜ å°„è¡¨

| Score åˆ†æ•° | æƒ…æ„Ÿå«ä¹‰ | ä¸»é¢˜è‰² | è¾¹æ¡†è‰² | å‘å…‰æ•ˆæœ | æ–‡å­—è‰² |
|-----------|---------|--------|--------|---------|--------|
| **+3** | å®Œç¾åº”ç­” | Pink | `pink-500/50` | `rgba(236,72,153,0.3)` | `pink-100` |
| **+2** | é«˜æƒ…å•† | Pink | `pink-500/50` | `rgba(236,72,153,0.3)` | `pink-100` |
| **+1** | æ¸©å’Œå›å¤ | Cyan | `cyan-500/30` | `rgba(6,182,212,0.2)` | `zinc-100` |
| **0** | ä¸­ç«‹æ€åº¦ | Cyan | `cyan-500/30` | `rgba(6,182,212,0.2)` | `zinc-100` |
| **-1** | ç¨æ˜¾ç”Ÿç¡¬ | Cyan | `cyan-500/30` | `rgba(6,182,212,0.2)` | `zinc-100` |
| **-2** | å®¹æ˜“å°´å°¬ | Purple | `purple-600/50` | `rgba(147,51,234,0.3)` | `purple-100` |
| **-3** | å…³ç³»å±æœº | Purple | `purple-600/50` | `rgba(147,51,234,0.3)` | `purple-100` |

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åç«¯æµ‹è¯•
```bash
cd backend
# é‡å¯åç«¯æœåŠ¡
uvicorn main:app --reload --host 127.0.0.1 --port 8000
```

**æµ‹è¯• Prompt**ï¼š
```bash
curl -X POST http://127.0.0.1:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"user_input": "ä»Šå¤©æƒ³ä½ äº†"}'
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "analysis": "å¯¹æ–¹åœ¨è¡¨è¾¾æ€å¿µ...",
    "options": [
      {
        "style": "TSUNDERE",
        "style_name": "å‚²å¨‡",
        "text": "å…¶å®...æˆ‘ä¹Ÿä¸æ˜¯ç‰¹æ„ç­‰ä½ çš„å•¦",  // çº¯å‡€æ–‡æœ¬
        "kaomoji": "(â„ â„â€¢â„Ï‰â„â€¢â„ â„)",        // åˆ†ç¦»çš„é¢œæ–‡å­—
        "score": 2
      }
    ]
  }
}
```

---

### 2. å‰ç«¯æµ‹è¯•

#### å¯åŠ¨ Vue åº”ç”¨
```bash
cd client
npm run dev  # æˆ– pnpm dev
```

#### æµ‹è¯•æ£€æŸ¥ç‚¹
- [ ] **MessageBubble** - æ‰“å¼€èŠå¤©ç•Œé¢ï¼ŒæŸ¥çœ‹é€‰é¡¹å¡ç‰‡
  - æ˜¯å¦æ˜¾ç¤º `â¤ +2` å¾½ç« 
  - æ˜¯å¦ç§»é™¤äº†åŸæœ‰çš„"å‚²å¨‡/è°„åªš"æ ‡ç­¾
  - é¢œæ–‡å­—æ˜¯å¦åœ¨å³ä¸‹è§’æ˜¾ç¤º
  - Hover æ—¶æ˜¯å¦æœ‰å‘å…‰æ•ˆæœ

- [ ] **ChoiceMatrix** - å…¨å±é€‰æ‹©æ¨¡å¼
  - ä¸‰ä¸ªé€‰é¡¹çš„é¢œè‰²æ˜¯å¦æ ¹æ® `score` ä¸åŒ
  - é€‰ä¸­åæ˜¯å¦æœ‰ç™½è‰²å…‰æ™•
  - èƒŒæ™¯æ°´å°æ˜¯å¦æ˜¾ç¤º

- [ ] **DashboardPanel** - å¿«é€Ÿæµ‹è¯•é¢æ¿
  - è¾“å…¥æ–‡æœ¬åç”Ÿæˆçš„é€‰é¡¹æ˜¯å¦ä½¿ç”¨æ–°å¡ç‰‡
  - é€‰é¡¹æ˜¯å¦æ˜¾ç¤ºå¥½æ„Ÿåº¦åˆ†æ•°

---

### 3. æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥

#### æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
```javascript
// F12 â†’ Network â†’ POST /api/chat
// æŸ¥çœ‹ Response Body
{
  "data": {
    "options": [
      {
        "text": "...",    // ä¸å«é¢œæ–‡å­—
        "kaomoji": "...", // ç‹¬ç«‹å­—æ®µ
        "score": 2
      }
    ]
  }
}
```

#### æŸ¥çœ‹ Vue DevTools
- Components â†’ OptionCard
- Props:
  - `option.text` âœ…
  - `option.kaomoji` âœ…
  - `option.score` âœ…

---

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### 1. AI è®­ç»ƒä¼˜åŒ–
å¦‚æœ AI ç”Ÿæˆçš„ `kaomoji` ä¸å¤Ÿå‡†ç¡®ï¼Œå¯ä»¥åœ¨ Prompt ä¸­æ·»åŠ ç¤ºä¾‹ï¼š
```python
KAOMOJI_EXAMPLES = """
# Kaomoji Examples by Style:
- TSUNDERE: (ï¿£^ï¿£), (â„ â„â€¢â„Ï‰â„â€¢â„ â„), (â„ â„>â„ â–½ â„<â„ â„)
- GENKI: (â‰§âˆ‡â‰¦)/, ãƒ¾(â‰§â–½â‰¦*)o, (ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§
- COLD: ( Â´_ã‚`), (Â¬_Â¬), ( Í¡Â° ÍœÊ– Í¡Â°)
- ROMANTIC: (Ë˜Â³Ë˜)â™¥, (ã¥ï½¡â—•â€¿â€¿â—•ï½¡)ã¥, (â™¥Ï‰â™¥*)
"""
```

### 2. é¢œè‰²ä¸»é¢˜æ‰©å±•
å¦‚æœéœ€è¦æ›´å¤šæƒ…æ„Ÿç»†åˆ†ï¼Œå¯ä»¥å¢åŠ é¢œè‰²ï¼š
- **+3**: é‡‘è‰²é—ªå…‰ï¼ˆå®Œç¾ï¼‰
- **-3**: çº¢è‰²è­¦å‘Šï¼ˆå±é™©ï¼‰

### 3. åŠ¨ç”»æ•ˆæœå¢å¼º
```vue
<!-- OptionCard.vue -->
<style>
@keyframes heart-beat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.score-badge:hover {
  animation: heart-beat 0.5s ease-in-out;
}
</style>
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å…¼å®¹æ€§å¤„ç†**
   - å¦‚æœæ—§æ•°æ®åº“ä¸­å­˜åœ¨æ²¡æœ‰ `kaomoji` å­—æ®µçš„å†å²è®°å½•ï¼Œéœ€è¦åœ¨å‰ç«¯åšé™çº§å¤„ç†ï¼š
     ```vue
     <span v-if="option.kaomoji">{{ option.kaomoji }}</span>
     <span v-else class="opacity-30">(^_^)</span>
     ```

2. **åç«¯éªŒè¯**
   - ç¡®ä¿ `ReplyOption` çš„ `kaomoji` å­—æ®µè®¾ä¸ºå¿…å¡«ï¼ˆ`...` è¡¨ç¤ºå¿…éœ€ï¼‰
   - å¦‚æœ AI æœªç”Ÿæˆï¼Œå¯ä»¥åœ¨åç«¯æ·»åŠ é»˜è®¤å€¼ï¼š
     ```python
     if not option.get('kaomoji'):
         option['kaomoji'] = '(ï¼¾â–½ï¼¾)'
     ```

3. **ç§»é™¤"è°„åªš/ä¸­äºŒ"**
   - å¦‚æœæƒ³ä¿ç•™è¿™äº›é£æ ¼ä½†ä¸æ˜¾ç¤ºåç§°ï¼Œä¿æŒåç«¯ `style_name` å­—æ®µï¼Œå‰ç«¯ç›´æ¥ç”¨ `score` å±•ç¤ºå³å¯
   - ç”¨æˆ·åªçœ‹åˆ°"â¤ +2"ï¼Œä¸ä¼šçœ‹åˆ°"è°„åªš"è¿™ä¸ªè¯

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### 1. åç«¯è¿ç§»
```bash
# å¤‡ä»½æ•°æ®åº“
cp backend/db.json backend/db.json.backup

# æ›´æ–° Python ä¾èµ–ï¼ˆå¦‚æœæœ‰æ–°å¢ï¼‰
pip install -r backend/requirements.txt

# é‡å¯æœåŠ¡
uvicorn main:app --reload
```

### 2. å‰ç«¯å‘å¸ƒ
```bash
cd client
npm run build  # æˆ– pnpm build
```

### 3. ç°åº¦å‘å¸ƒ
å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ AI ç”Ÿæˆè´¨é‡ï¼š
- æµ‹è¯• 100 æ¡å¯¹è¯
- æ£€æŸ¥ `kaomoji` æ˜¯å¦å‡†ç¡®åŒ¹é…é£æ ¼
- æ£€æŸ¥ `score` æ˜¯å¦åˆç†ï¼ˆé¿å…å…¨æ˜¯ +3 æˆ–å…¨æ˜¯ -3ï¼‰

---

**å®æ–½å®Œæˆæ—¥æœŸ**: 2026-01-29  
**ç‰ˆæœ¬**: v3.0  
**è´Ÿè´£äºº**: GitHub Copilot AI Assistant
